<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        .grid-container {
            display: grid;
            grid-template-columns: {% for _ in range(grid_x) %} 20px {% endfor %};
            padding-bottom: 20px;
        }
        .grid-item {
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.8);
            height: 0;
            padding-bottom: 100%;
        }
        .wall {
            background-color: rgba(20, 20, 20, 0.8)
        }
        .visited {
            background-color: rgba(0, 255, 0, 0.8)
        }

        .path {
            background-color: rgba(255, 106, 0, 0.8)
        }

        .start {
            background-color: rgba(255, 0, 0, 0.8)
        }
        .end {
            background-color: rgba(0, 0, 255, 0.8)
        }
</style>
</head>
<body>
    <input id="start_marker" class="marker_buttons" type="submit" value="Start Marker">
    <input id="end_marker" class="marker_buttons" type="submit" value="End Marker">
    <input id="wall_marker" class="marker_buttons" type="submit" value="Wall Marker">

    <div class="grid-container">
        {% for id in range(grid_x*grid_y) %}
            <div class="grid-item" id="i{{ id }}"></div>
        {% endfor %}
    </div>
    <form action="/" method="post">
        <label for="gridX">gridX</label><br>
        <input type="number" id="gridX" name="gridX" value="40"><br>
        <label for="gridY">gridY:</label><br>
        <input type="number" id="gridY" name="gridY" value="20"><br><br>
        <input type="submit" value="Change Grid Size">
    </form>
    <input id="start" type="submit" value="Start">
    <input id="reset" type="submit" value="Reset">
    <div id="data">nothing received yet</div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

    <script>
        $(document).ready(function() {
            let isMouseDown = false;
            let wall = false;
            let start = false;
            let end = false;
            $('.grid-item').mousedown(function() {
                isMouseDown = true;
                if (wall) {
                    $(this).removeClass("start").removeClass("visited").removeClass("end")
                    $(this).toggleClass("wall");
                } else if (start) {
                    $('.grid-item').removeClass("start")
                    $(this).removeClass("wall").removeClass("visited").removeClass("end");
                    $(this).toggleClass("start");
                } else if (end) {
                    $('.grid-item').removeClass("end")
                    $(this).removeClass("wall").removeClass("start").removeClass("visited")
                    $(this).toggleClass("end");
                }
            })
            .mouseup(function() {
                isMouseDown = false;
            }).mouseenter(function() {
                if(isMouseDown && wall){
                    $(this).toggleClass("wall");
                }
            });

            $('#start').click(function (){
                const start = $('.start').get(0).id.slice(1);
                const end = $('.end').get(0).id.slice(1);
                const walls = [];
                $('.wall').each(function() {
                    walls.push(this.id.slice(1));
                });
                walls.toString()
                document.cookie = "start=" + start + ";"
                document.cookie = "end=" + end + ";"
                document.cookie = "walls=" + walls + ";"
                const source = new EventSource('/');
                source.onmessage = function(e) {
                    if (e.data.startsWith("x")){
                        $('#' + e.data.slice(1)).addClass("path");
                    } else if (e.data.startsWith("i")) {
                        $('#' + e.data).addClass("visited");
                    }else {
                        source.close()
                    }

                }
            });

            $('#reset').click(function (){
                $('.grid-item').removeClass("wall").removeClass("start").removeClass("visited").removeClass("end");
            });

            $('#start_marker').click(function (){
                $('.marker_buttons').prop('disabled', false);
                $(this).prop('disabled', true);
                start = true;
                wall = false;
                end = false;
            });

            $('#wall_marker').click(function (){
                $('.marker_buttons').prop('disabled', false)
                $(this).prop('disabled', true)
                start = false;
                wall = true;
                end = false;

            });

            $('#end_marker').click(function (){
                $('.marker_buttons').prop('disabled', false)
                $(this).prop('disabled', true)
                start = false;
                wall = false;
                end = true;
            });

        });
    </script>
</body>
</html>
